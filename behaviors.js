/*! behaviors.js is part of Webrecorder project. Copyright (C) 2021-2025, Webrecorder Software. Licensed under the Affero General Public License v3. */(()=>{var t={480:(t,e,i)=>{"use strict";function o(t,e=document,i=null){return n(t,!0,e,i)}function n(t,e,i,o=null){t=function(t){function e(){o&&(a.length>0&&/^[~+>]$/.test(a[a.length-1])&&a.push(" "),a.push(o))}var i,o,n,s,a=[],r=[0],l=0,c=/(?:[^\\]|(?:^|[^\\])(?:\\\\)+)$/,d=/^\s+$/,h=[/\s+|\/\*|["'>~+[(]/g,/\s+|\/\*|["'[\]()]/g,/\s+|\/\*|["'[\]()]/g,null,/\*\//g];for(t=t.trim();;){if(o="",(n=h[r[r.length-1]]).lastIndex=l,!(i=n.exec(t))){o=t.substr(l),e();break}if((s=l)<(l=n.lastIndex)-i[0].length&&(o=t.substring(s,l-i[0].length)),r[r.length-1]<3){if(e(),"["===i[0])r.push(1);else if("("===i[0])r.push(2);else if(/^["']$/.test(i[0]))r.push(3),h[3]=new RegExp(i[0],"g");else if("/*"===i[0])r.push(4);else if(/^[\])]$/.test(i[0])&&r.length>0)r.pop();else if(/^(?:\s+|[~+>])$/.test(i[0])&&(a.length>0&&!d.test(a[a.length-1])&&0===r[r.length-1]&&a.push(" "),1===r[r.length-1]&&5===a.length&&"="===a[2].charAt(a[2].length-1)&&(a[4]=" "+a[4]),d.test(i[0])))continue;a.push(i[0])}else a[a.length-1]+=o,c.test(a[a.length-1])&&(4===r[r.length-1]&&(a.length<2||d.test(a[a.length-2])?a.pop():a[a.length-1]=" ",i[0]=""),r.pop()),a[a.length-1]+=i[0]}return a.join("").trim()}(t);let n=i.querySelector(t);if(document.head.createShadowRoot||document.head.attachShadow){if(!e&&n)return n;return s(t,",").reduce(((t,n)=>{if(!e&&t)return t;const l=s(n.replace(/^\s+/g,"").replace(/\s*([>+~]+)\s*/g,"$1")," ").filter((t=>!!t)).map((t=>s(t,">"))),c=l.length-1,d=function(t=null,e,i=null){let o=[];if(i)o=i;else{const t=function(e){for(let i=0;i<e.length;i++){const n=e[i];o.push(n),n.shadowRoot&&t(n.shadowRoot.querySelectorAll("*"))}};e.shadowRoot&&t(e.shadowRoot.querySelectorAll("*")),t(e.querySelectorAll("*"))}return t?o.filter((e=>e.matches(t))):o}(l[c][l[c].length-1],i,o),h=function(t,e,i){return o=>{let n=e,s=o,l=!1;for(;s&&!a(s);){let e=!0;if(1===t[n].length)e=s.matches(t[n]);else{const o=[].concat(t[n]).reverse();let a=s;for(const t of o){if(!a||!a.matches(t)){e=!1;break}a=r(a,i)}}if(e&&0===n){l=!0;break}e&&n--,s=r(s,i)}return l}}(l,c,i);return e?t=t.concat(d.filter(h)):(t=d.find(h))||null}),e?[]:null)}return e?i.querySelectorAll(t):n}function s(t,e){return t.match(/\\?.|^$/g).reduce(((t,i)=>('"'!==i||t.sQuote?"'"!==i||t.quote?t.quote||t.sQuote||i!==e?t.a[t.a.length-1]+=i:t.a.push(""):(t.sQuote^=1,t.a[t.a.length-1]+=i):(t.quote^=1,t.a[t.a.length-1]+=i),t)),{a:[""]}).a}function a(t){return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE||t.nodeType===Node.DOCUMENT_NODE}function r(t,e){const i=t.parentNode;return i&&i.host&&11===i.nodeType?i.host:i===e?null:i}i.d(e,{Jp:()=>o})},702:(t,e,i)=>{"use strict";i.r(e),i.d(e,{AutoClick:()=>s});var o=i(841),n=i(721);class s extends o.BackgroundBehavior{_donePromise;_markDone;selector;seenElem=new WeakSet;static id="Autoclick";constructor(t="a"){super(),this.selector=t,this._donePromise=new Promise((t=>this._markDone=t))}nextSameOriginLink(){try{const t=document.querySelectorAll(this.selector);for(const e of t){const t=e;if((!t.href||t.href.startsWith(self.location.origin))&&(t.isConnected&&t.checkVisibility()&&!this.seenElem.has(t)))return this.seenElem.add(t),t}}catch(t){this.debug(t.toString())}return null}async start(){const t=self.location.href,e=t=>(t.preventDefault(),!1);for(window.addEventListener("beforeunload",e);;){const e=this.nextSameOriginLink();if(!e)break;await this.processElem(e,t)}window.removeEventListener("beforeunload",e),this._markDone()}async processElem(t,e){if(!t.target){if(t.href){if(!await(0,n.addToExternalSet)(t.href))return;this.debug("Clicking on link: "+t.href)}else this.debug("Click empty link");t.click(),await(0,n.sleep)(250),self.location.href!=e&&await new Promise((t=>{window.addEventListener("popstate",(()=>{t(null)}),{once:!0}),window.history.back()}))}}catch(t){this.debug(t.toString())}done(){return this._donePromise}}},894:(t,e,i)=>{"use strict";i.r(e),i.d(e,{AutoFetcher:()=>c});var o=i(480),n=i(841),s=i(721);const a=/\s*(\S*\s+[\d.]+[wx]),|(?:\s*,(?:\s+|(?=https?:)))/,r=/(url\s*\(\s*[\\"']*)([^)'"]+)([\\"']*\s*\))/gi,l=/(@import\s*[\\"']*)([^)'";]+)([\\"']*\s*;?)/gi;class c extends n.BackgroundBehavior{urlSet=new Set;pendingQueue=[];waitQueue=[];mutationObserver;numPending=0;numDone=0;headers;_donePromise;_markDone;active;running=!1;static id="Autofetcher";constructor(t=!1,e=null,i=!1){super(),this.headers=e||{},this._donePromise=new Promise((t=>this._markDone=t)),this.active=t,this.active&&i&&document.addEventListener("DOMContentLoaded",(()=>this.initObserver()))}get numFetching(){return this.numDone+this.numPending+this.pendingQueue.length}async start(){this.active&&(this.initObserver(),this.run(),(0,s.sleep)(500).then((()=>{this.pendingQueue.length||this.numPending||this._markDone(null)})))}done(){return this._donePromise}async run(){this.running=!0;for(const t of this.waitQueue)this.doFetch(t);this.waitQueue=[],this.extractSrcSrcSetAll(document),this.extractStyleSheets(),this.extractDataAttributes(document)}isValidUrl(t){return t&&(t.startsWith("http:")||t.startsWith("https:"))}queueUrl(t,e=!1){try{t=new URL(t,document.baseURI).href}catch(t){return!1}return!!this.isValidUrl(t)&&(!this.urlSet.has(t)&&(this.urlSet.add(t),this.running||e?this.doFetch(t):this.waitQueue.push(t),!0))}async doFetchStream(t){try{const e=await fetch(t,{credentials:"include",referrerPolicy:"origin-when-cross-origin"});this.debug(`Autofetch: started ${t}`);const i=e.body.getReader();let o=null;for(;(o=await i.read())&&!o.done;);return this.debug(`Autofetch: finished ${t}`),!0}catch(t){return this.debug(t),!1}}async doFetchNonCors(t){try{const e=new AbortController;await fetch(t,{mode:"no-cors",credentials:"include",referrerPolicy:"origin-when-cross-origin",headers:this.headers,abort:e}),e.abort(),this.debug(`Autofetch: started non-cors stream for ${t}`)}catch(e){this.debug(`Autofetch: failed non-cors for ${t}`)}}async doFetch(t){if(this.pendingQueue.push(t),this.numPending<=6){for(;this.pendingQueue.length>0;){const t=this.pendingQueue.shift();this.numPending++,await(0,s.doExternalFetch)(t)||await this.doFetchNonCors(t),this.numPending--,this.numDone++}this.numPending||this._markDone(null)}}initObserver(){this.mutationObserver||(this.mutationObserver=new MutationObserver((t=>this.observeChange(t))),this.mutationObserver.observe(document.documentElement,{characterData:!1,characterDataOldValue:!1,attributes:!0,attributeOldValue:!0,subtree:!0,childList:!0,attributeFilter:["srcset","loading"]}))}processChangedNode(t){switch(t.nodeType){case Node.ATTRIBUTE_NODE:if("srcset"===t.nodeName&&this.extractSrcSetAttr(t.nodeValue),"loading"===t.nodeName&&"lazy"===t.nodeValue){const e=t.parentNode;"IMG"===e.tagName&&e.setAttribute("loading","eager")}break;case Node.TEXT_NODE:t.parentNode&&"STYLE"===t.parentNode.tagName&&this.extractStyleText(t.nodeValue);break;case Node.ELEMENT_NODE:t.sheet&&this.extractStyleSheet(t.sheet),this.extractSrcSrcSet(t),setTimeout((()=>this.extractSrcSrcSetAll(t)),1e3),setTimeout((()=>this.extractDataAttributes(t)),1e3)}}observeChange(t){for(const e of t)if(this.processChangedNode(e.target),"childList"===e.type)for(const t of e.addedNodes)this.processChangedNode(t)}extractSrcSrcSetAll(t){const e=(0,o.Jp)("img[srcset], img[data-srcset], img[data-src], noscript > img[src], img[loading='lazy'], video[srcset], video[data-srcset], video[data-src], audio[srcset], audio[data-srcset], audio[data-src], picture > source[srcset], picture > source[data-srcset], picture > source[data-src], video > source[srcset], video > source[data-srcset], video > source[data-src], audio > source[srcset], audio > source[data-srcset], audio > source[data-src]",t);for(const t of e)this.extractSrcSrcSet(t)}extractSrcSrcSet(t){if(!t||t.nodeType!==Node.ELEMENT_NODE)return void console.warn("No elem to extract from");const e=t.getAttribute("data-src");e&&this.queueUrl(e),"lazy"===t.getAttribute("loading")&&t.setAttribute("loading","eager");const i=t.getAttribute("srcset");i&&this.extractSrcSetAttr(i);const o=t.getAttribute("data-srcset");o&&this.extractSrcSetAttr(o);const n=t.getAttribute("src");n&&(i||o||"NOSCRIPT"===t.parentElement.tagName)&&this.queueUrl(n)}extractSrcSetAttr(t){for(const e of t.split(a))if(e){const t=e.trim().split(" ");this.queueUrl(t[0])}}extractStyleSheets(t){t=t||document;for(const e of t.styleSheets)this.extractStyleSheet(e)}extractStyleSheet(t){let e;try{e=t.cssRules||t.rules}catch(t){return void this.debug("Can't access stylesheet")}for(const t of e)t.type===CSSRule.MEDIA_RULE&&this.extractStyleText(t.cssText)}extractStyleText(t){const e=(t,e,i,o)=>(this.queueUrl(i),e+i+o);t.replace(r,e).replace(l,e)}extractDataAttributes(t){for(const e of(0,s.xpathNodes)("//@*[starts-with(name(), 'data-') and (starts-with(., 'http') or starts-with(., '/') or starts-with(., './') or starts-with(., '../'))]",t))this.queueUrl(e.value)}}},376:(t,e,i)=>{"use strict";i.r(e),i.d(e,{Autoplay:()=>a});var o=i(480),n=i(841),s=i(721);class a extends n.BackgroundBehavior{mediaSet;autofetcher;numPlaying;promises;_initDone;running=!1;polling=!1;static id="Autoplay";constructor(t,e=!1){super(),this.mediaSet=new Set,this.autofetcher=t,this.numPlaying=0,this.promises=[],this._initDone=()=>null,this.promises.push(new Promise((t=>this._initDone=t))),e&&document.addEventListener("DOMContentLoaded",(()=>this.pollAudioVideo()))}async start(){this.running=!0,this.pollAudioVideo(),this._initDone()}async pollAudioVideo(){if(!this.polling){for(this.polling=!0;;){for(const[,t]of(0,o.Jp)("video, audio, picture").entries())if(!t.__bx_autoplay_found){if(!this.running){this.processFetchableUrl(t)&&(t.__bx_autoplay_found=!0);continue}await this.loadMedia(t),t.__bx_autoplay_found=!0}await(0,s.sleep)(500)}this.polling=!1}}fetchSrcUrl(t){const e=t.src||t.currentSrc;return!!e&&(!(!e.startsWith("http:")&&!e.startsWith("https:"))&&(this.mediaSet.has(e)||(this.debug("fetch media source URL: "+e),this.mediaSet.add(e),this.autofetcher.queueUrl(e)),!0))}processFetchableUrl(t){let e=this.fetchSrcUrl(t);const i=t.querySelectorAll("source");for(const t of i){const i=this.fetchSrcUrl(t);e=e||i}return e}async loadMedia(t){this.debug("processing media element: "+t.outerHTML);const e=this.processFetchableUrl(t);t.play?e?t.paused||(t.pause(),this.debug("media URL found, pausing playback")):t.paused||t.currentTime?(t.paused?this.debug("no src url found, attempting to click or play: "+t.outerHTML):this.debug("media already playing, waiting for full playback to finish: "+t.outerHTML),this.attemptMediaPlay(t).then((async e=>{let i=!0;for(e&&e.then((()=>i=!1));i;)this.processFetchableUrl(t)&&(i=!1),this.debug("Waiting for fixed URL or media to finish: "+t.currentSrc),await(0,s.sleep)(1e3)}))):t.currentSrc&&this.debug("media playing from non-URL source: "+t.currentSrc):this.debug("media not playable, skipping")}async attemptMediaPlay(t){let e;const i=new Promise((t=>{e=t}));let o;const n=new Promise((t=>{o=t}));if(n.then((()=>this.promises.push(i))),!t.paused&&t.currentTime>0&&o(),t.addEventListener("loadstart",(()=>{this.debug("media event: loadstart"),o(!0)})),t.addEventListener("playing",(()=>{this.debug("media event: playing"),o(!0)})),t.addEventListener("loadeddata",(()=>this.debug("media event: loadeddata"))),t.addEventListener("ended",(()=>{this.debug("media event: ended"),e()})),t.addEventListener("pause",(()=>{this.debug("media event: pause"),e()})),t.addEventListener("abort",(()=>{this.debug("media event: abort"),e()})),t.addEventListener("error",(()=>{this.debug("media event: error"),e()})),t.addEventListener("stalled",(()=>{this.debug("media event: stalled"),e()})),t.addEventListener("suspend",(()=>{this.debug("media event: suspend"),e()})),t.muted=!0,!t.paused&&t.currentTime>0)return i;return!t.closest("a")&&(t.click(),await Promise.race([n,(0,s.sleep)(1e3)]))?(this.debug("play started after media.click()"),i):(t.play(),await Promise.race([n,(0,s.sleep)(1e3)])&&this.debug("play started after media.play()"),i)}done(){return Promise.allSettled(this.promises)}}},234:(t,e,i)=>{"use strict";i.r(e),i.d(e,{AutoScroll:()=>s});var o=i(841),n=i(721);class s extends o.Behavior{autoFetcher;showMoreQuery;state={segments:1};lastScrollPos;samePosCount;origPath;constructor(t){super(),this.autoFetcher=t,this.showMoreQuery="//*[contains(text(), 'show more') or contains(text(), 'Show more')]",this.lastScrollPos=-1,this.samePosCount=0,this.origPath=document.location.pathname}static id="Autoscroll";currScrollPos(){return Math.round(self.scrollY+self.innerHeight)}canScrollMore(){const t=self.document.scrollingElement||self.document.body;return this.currScrollPos()<Math.max(t.clientHeight,t.scrollHeight)}hasScrollEL(t){try{return!!self.getEventListeners(t).scroll}catch(t){return this.debug("getEventListeners() not available"),!0}}async shouldScroll(){if(!this.hasScrollEL(self.window)&&!this.hasScrollEL(self.document)&&!this.hasScrollEL(self.document.body))return!1;if(window.frames.length>=2)return!0;const t=self.document.scrollingElement.scrollHeight,e=this.autoFetcher.numFetching,i=.98*document.scrollingElement.scrollHeight-self.innerHeight;return window.scrollTo({top:i,left:0,behavior:"smooth"}),await(0,n.sleep)(500),(t!==self.document.scrollingElement.scrollHeight||e<this.autoFetcher.numFetching)&&(window.scrollTo({top:0,left:0,behavior:"auto"}),!0)}shouldScrollUp(){return 0!==self.window.scrollY&&!((self.window.scrollY+self.scrollHeight)/self.document.scrollingElement.scrollHeight<.9)}async*[Symbol.asyncIterator](){this.shouldScrollUp()?yield*this.scrollUp():await this.shouldScroll()?yield*this.scrollDown():yield this.getState("Skipping autoscroll, page seems to not be responsive to scrolling events")}async*scrollDown(){let t=0,e=null,i=!1;const o={top:Math.min(.1*self.document.scrollingElement.clientHeight,30),left:0,behavior:"auto"};let s=self.document.scrollingElement.scrollHeight;for(;this.canScrollMore();){if(document.location.pathname!==this.origPath)return(0,n.behaviorLog)(`Location Changed, stopping scroll: ${document.location.pathname} != ${this.origPath}`,"info"),void(0,n.addLink)(document.location.href);const a=self.document.scrollingElement.scrollHeight;if(a>s&&(this.state.segments++,s=a),e||i||(e=(0,n.xpathNode)(this.showMoreQuery)),e&&(0,n.isInViewport)(e)&&(yield this.getState("Clicking 'Show More', awaiting more content"),e.click(),await(0,n.sleep)(n.waitUnit),await Promise.race([(0,n.waitUntil)((()=>self.document.scrollingElement.scrollHeight>a),500),(0,n.sleep)(3e4)]),self.document.scrollingElement.scrollHeight===a&&(i=!0),e=null),self.scrollBy(o),await(0,n.sleep)(75),1===this.state.segments)yield this.getState(`Scrolling down by ${o.top} pixels every 0.075 seconds`),t=2;else{const e=t/(this.state.segments-1);this.debug(`Waiting up to ${e} seconds for more scroll segments`);const i=Date.now();await Promise.race([(0,n.waitUntil)((()=>this.canScrollMore()),75),(0,n.sleep)(e)]),t+=2*(Date.now()-i)}const r=this.currScrollPos();if(r===this.lastScrollPos){if(++this.samePosCount>=2)break}else this.samePosCount=0;this.lastScrollPos=r}}async*scrollUp(){const t={top:-Math.min(.1*self.document.scrollingElement.clientHeight,30),left:0,behavior:"auto"};let e=self.document.scrollingElement.scrollHeight;for(;self.scrollY>0;){const i=self.document.scrollingElement.scrollHeight;i>e&&(this.state.segments++,e=i),self.scrollBy(t),await(0,n.sleep)(75),1===this.state.segments?yield this.getState(`Scrolling up by ${t.top} pixels every 0.075 seconds`):await Promise.race([(0,n.waitUntil)((()=>self.scrollY>0),75),(0,n.sleep)(2e3*(this.state.segments-1))])}}}},607:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BehaviorManager:()=>w});var o=i(894),n=i(376),s=i(234),a=i(702),r=i(721),l=i(841),c=i(954);const d={autofetch:!0,autoplay:!0,autoscroll:!0,autoclick:!0,siteSpecific:!0},h="a[href]",u="href";class w{autofetch;behaviors;loadedBehaviors;mainBehavior;mainBehaviorClass;inited;started;timeout;opts;linkOpts;constructor(){this.behaviors=[],this.loadedBehaviors=c.default.reduce(((t,e)=>(t[e.id]=e,t)),{}),this.mainBehavior=null,this.inited=!1,this.started=!1,this.linkOpts={selector:h,extractName:u},(0,r.behaviorLog)("Loaded behaviors for: "+self.location.href)}init(t=d,e=!1,i=null){if((!this.inited||e)&&(this.inited=!0,this.opts=t,self.window)){if(this.timeout=t.timeout,void 0!==t.log){let e=t.log;"string"==typeof e&&(e=self[e]),"function"==typeof e?(0,r._setLogFunc)(e):!1===e&&(0,r._setLogFunc)(null)}if(this.autofetch=new o.AutoFetcher(!!t.autofetch,t.fetchHeaders,t.startEarly),t.autofetch&&((0,r.behaviorLog)("Using AutoFetcher"),this.behaviors.push(this.autofetch)),t.autoplay&&((0,r.behaviorLog)("Using Autoplay"),this.behaviors.push(new n.Autoplay(this.autofetch,t.startEarly))),t.autoclick&&((0,r.behaviorLog)("Using AutoClick"),this.behaviors.push(new a.AutoClick(t.clickSelector||"a"))),i)for(const t of i)try{this.load(t)}catch(e){(0,r.behaviorLog)(`Failed to load custom behavior: ${e} ${t}`)}}}selectMainBehavior(){if(this.mainBehavior)return;const t=this.opts;let e=!1;if(t.siteSpecific)for(const i in this.loadedBehaviors){const o=this.loadedBehaviors[i];if(o.isMatch()){(0,r.behaviorLog)("Using Site-Specific Behavior: "+i),this.mainBehaviorClass=o;const n="object"==typeof t.siteSpecific&&t.siteSpecific[i]||{};try{this.mainBehavior=new l.BehaviorRunner(o,n)}catch(t){(0,r.behaviorLog)({msg:t.toString(),siteSpecific:!0},"error")}e=!0;break}}return!e&&t.autoscroll&&((0,r.behaviorLog)("Using Autoscroll"),this.mainBehaviorClass=s.AutoScroll,this.mainBehavior=new s.AutoScroll(this.autofetch)),this.mainBehavior&&(this.behaviors.push(this.mainBehavior),this.mainBehavior instanceof l.BehaviorRunner)?this.mainBehavior.behaviorProps.id:""}load(t){if("string"!=typeof t.id)return void(0,r.behaviorLog)('Behavior class must have a string string "id" property',"error");const e=t.id;"function"==typeof t?"function"==typeof t.isMatch&&"function"==typeof t.init?this.isInTopFrame()||t.runInIframe?((0,r.behaviorLog)(`Behavior class ${e}: loaded`,"debug"),this.loadedBehaviors[e]=t):(0,r.behaviorLog)(`Behavior class ${e}: not running in iframes (.runInIframe not set)`,"debug"):(0,r.behaviorLog)("Behavior class must have an is `isMatch()` and `init()` static methods","error"):(0,r.behaviorLog)(`Must pass a class object, got ${t}`,"error")}async resolve(t){const e=await i(75)(`${t}`);if(Array.isArray(e))for(const t of e)this.load(t);else this.load(e)}async awaitPageLoad(){this.selectMainBehavior(),this.mainBehavior?.awaitPageLoad?((0,r.behaviorLog)("Waiting for custom page load via behavior"),await this.mainBehavior.awaitPageLoad({Lib:r})):(0,r.behaviorLog)("No custom wait behavior")}async run(t=d,e=!1){if(e&&(this.started=!1),this.started)return void this.unpause();this.init(t,e),this.selectMainBehavior(),await(0,r.awaitLoad)(),this.behaviors.forEach((t=>{const e=t.id||t.constructor.id||"(Unnamed)";(0,r.behaviorLog)("Starting behavior: "+e,"debug"),t.start()})),this.started=!0,await(0,r.sleep)(500);const i=Promise.allSettled(this.behaviors.map((t=>t.done())));this.timeout?((0,r.behaviorLog)(`Waiting for behaviors to finish or ${this.timeout}ms timeout`,"debug"),await Promise.race([i,(0,r.sleep)(this.timeout)])):((0,r.behaviorLog)("Waiting for behaviors to finish","debug"),await i),(0,r.behaviorLog)("All Behaviors Done for "+self.location.href,"debug"),this.mainBehavior&&this.mainBehaviorClass.cleanup&&this.mainBehavior.cleanup()}async runOne(t,e={}){const i=c.default.find((e=>e.name===t));if(void 0===i)return void console.error(`No behavior of name ${t} found`);const o=new l.BehaviorRunner(i,e);o.start(),console.log(`Running behavior: ${t}`),await o.done(),console.log(`Behavior ${t} completed`)}pause(){(0,r.behaviorLog)("Pausing Main Behavior"+this.mainBehaviorClass.name),this.behaviors.forEach((t=>t.pause()))}unpause(){this.behaviors.forEach((t=>t.unpause()))}doAsyncFetch(t){return(0,r.behaviorLog)("Queueing Async Fetch Url: "+t),this.autofetch.queueUrl(t,!0)}isInTopFrame(){return self.window.top===self.window||window.__WB_replay_top===self.window}async extractLinks(t=h,e="href",i=!1){return this.linkOpts={selector:t,extractName:e,attrOnly:i},(0,r.checkToJsonOverride)(),await this.extractLinksActual()}async extractLinksActual(){const{selector:t=h,extractName:e=u,attrOnly:i=!1}=this.linkOpts,o=new Set;document.querySelectorAll(t).forEach((t=>{let n=i?null:t[e];n||(n=t.getAttribute(e)),"string"==typeof n&&o.add(n)}));const n=[];for(const t of o)n.push((0,r.addLink)(t));await Promise.allSettled(n)}}(0,r._setBehaviorManager)(w),(0,r.installBehaviors)(self)},841:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BackgroundBehavior:()=>n,Behavior:()=>s,BehaviorRunner:()=>a});var o=i(721);class n{debug(t){(0,o.behaviorLog)(t,"debug")}error(t){(0,o.behaviorLog)(t,"error")}log(t,e="info"){(0,o.behaviorLog)(t,e)}}class s extends n{_running;paused;_unpause;state;scrollOpts;constructor(){super(),this._running=null,this.paused=null,this._unpause=null,this.state={},this.scrollOpts={behavior:"smooth",block:"center",inline:"center"}}start(){this._running=this.run()}done(){return this._running?this._running:Promise.resolve()}async run(){try{for await(const t of this)this.debug(t),this.paused&&await this.paused;this.debug(this.getState("done!"))}catch(t){this.error(t.toString())}}pause(){this.paused||(this.paused=new Promise((t=>{this._unpause=t})))}unpause(){this._unpause&&(this._unpause(),this.paused=null,this._unpause=null)}getState(t,e){return e&&(void 0===this.state[e]?this.state[e]=1:this.state[e]++),{state:this.state,msg:t}}cleanup(){}async awaitPageLoad(t){}static load(){self.__bx_behaviors?self.__bx_behaviors.load(this):console.warn(`Could not load ${this.name} behavior: window.__bx_behaviors is not initialized`)}async*[Symbol.asyncIterator](){yield}}class a extends n{inst;behaviorProps;ctx;_running;paused;_unpause;get id(){return this.inst?.constructor.id}constructor(t,e={}){if(super(),this.behaviorProps=t,this.inst=new t,"function"!=typeof this.inst.run||"AsyncGeneratorFunction"!==this.inst.run.constructor.name)throw Error("Invalid behavior: missing `async run*` instance method");let{state:i,opts:n}=t.init();i=i||{},n=n?{...n,...e}:e;this.ctx={Lib:o,state:i,opts:n,log:async(t,e)=>this.wrappedLog(t,e)},this._running=null,this.paused=null,this._unpause=null}wrappedLog(t,e="info"){let i;i="string"==typeof t||t instanceof String?{msg:t}:t,this.log({...i,behavior:this.behaviorProps.id,siteSpecific:!0},e)}start(){this._running=this.run()}done(){return this._running?this._running:Promise.resolve()}async run(){try{for await(const t of this.inst.run(this.ctx))t&&this.wrappedLog(t),this.paused&&await this.paused;this.debug({msg:"done!",behavior:this.behaviorProps.id})}catch(t){this.error({msg:t.toString(),behavior:this.behaviorProps.id})}}pause(){this.paused||(this.paused=new Promise((t=>{this._unpause=t})))}unpause(){this._unpause&&(this._unpause(),this.paused=null,this._unpause=null)}cleanup(){}async awaitPageLoad(){this.inst.awaitPageLoad&&await this.inst.awaitPageLoad(this.ctx)}static load(){self.__bx_behaviors?self.__bx_behaviors.load(this):console.warn(`Could not load ${this.name} behavior: window.__bx_behaviors is not initialized`)}}},721:(t,e,i)=>{"use strict";i.r(e),i.d(e,{HistoryState:()=>C,RestoreState:()=>N,_setBehaviorManager:()=>E,_setLogFunc:()=>k,addLink:()=>v,addToExternalSet:()=>y,assertContentValid:()=>L,awaitLoad:()=>h,behaviorLog:()=>p,callBinding:()=>g,checkToJsonOverride:()=>m,doExternalFetch:()=>b,getState:()=>I,initFlow:()=>x,installBehaviors:()=>T,isInViewport:()=>V,iterChildElem:()=>A,iterChildMatches:()=>M,nextFlowStep:()=>_,openWindow:()=>P,scrollAndClick:()=>a,scrollIntoView:()=>F,scrollToOffset:()=>R,sleep:()=>l,waitForNetworkIdle:()=>S,waitUnit:()=>r,waitUntil:()=>c,waitUntilNode:()=>d,xpathNode:()=>B,xpathNodes:()=>U,xpathString:()=>O});let o=console.log,n=null;const s={behavior:"smooth",block:"center",inline:"center"};async function a(t,e=500,i=s){t.scrollIntoView(i),await l(e),t.click()}const r=200;async function l(t){return new Promise((e=>setTimeout(e,t)))}async function c(t,e=r){for(;!t();)await l(e)}async function d(t,e=document,i=null,o=1e3,n=r){let s=null,a=!1;const l=c((()=>(s=B(t,e),a||s!==i&&null!==s)),n),d=new Promise((t=>setTimeout((()=>{a=!0,t("TIMEOUT")}),o)));return await Promise.race([l,d]),s}async function h(t){const e=t?t.contentDocument:document,i=t?t.contentWindow:window;return new Promise((t=>{"complete"===e.readyState?t(null):i.addEventListener("load",t)}))}function u(t){if(t.toJSON)try{t.__bx__toJSON=t.toJSON,delete t.toJSON}catch(t){}}function w(t){if(t.__bx__toJSON)try{t.toJSON=t.__bx__toJSON,delete t.__bx__toJSON}catch(t){}}let f=!1;function m(){f=!!(Object.toJSON||Object.prototype.toJSON||Array.toJSON||Array.prototype.toJSON)}async function g(t,e){try{return f&&(u(Object),u(Object.prototype),u(Array),u(Array.prototype)),t(e)}catch(i){return t(JSON.stringify(e))}finally{f&&(w(Object),w(Object.prototype),w(Array),w(Array.prototype))}}async function p(t,e="debug"){o&&await g(o,{data:t,type:e})}async function v(t){if("function"==typeof self.__bx_addLink)return await g(self.__bx_addLink,t)}async function b(t){return"function"==typeof self.__bx_fetch&&await g(self.__bx_fetch,t)}async function y(t){return"function"!=typeof self.__bx_addSet||await g(self.__bx_addSet,t)}async function S(t=500,e=0){if("function"==typeof self.__bx_netIdle)return await g(self.__bx_netIdle,{idleTime:t,concurrency:e})}async function x(t){return"function"==typeof self.__bx_initFlow?await g(self.__bx_initFlow,t):-1}async function _(t){return"function"==typeof self.__bx_nextFlowStep?await g(self.__bx_nextFlowStep,t):{done:!0,msg:""}}function L(t,e="invalid"){"function"==typeof self.__bx_contentCheckFailed&&(t()||(p("Behavior content check failed: "+e,"error"),g(self.__bx_contentCheckFailed,e)))}async function P(t){if(self.__bx_open){const e=new Promise((t=>self.__bx_openResolve=t));await g(self.__bx_open,{url:t});let i=null;try{if(i=await e,i)return i}catch(t){console.warn(t)}finally{delete self.__bx_openResolve}}return window.open(t)}function k(t){o=t}function E(t){n=t}function T(t){t.__bx_behaviors=new n}class N{matchValue;constructor(t,e){this.matchValue=O(t,e)}async restore(t,e){let i=null;for(;i=B(t),!i;)await l(100);return B(e.replace("$1",this.matchValue),i)}}class C{loc;constructor(t){this.loc=window.location.href,t()}get changed(){return window.location.href!==this.loc}async goBack(t){if(!this.changed)return Promise.resolve(!0);const e=B(t);return new Promise((t=>{window.addEventListener("popstate",(()=>{t(null)}),{once:!0}),e?e.click():window.history.back()}))}}function B(t,e){return e=e||document,document.evaluate(t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE).singleNodeValue}function*U(t,e){e=e||document;const i=document.evaluate(t,e,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE);let o=null;for(;null!==(o=i.iterateNext());)yield o}function O(t,e){return e=e||document,document.evaluate(t,e,null,XPathResult.STRING_TYPE).stringValue}async function*A(t,e,i){let o=t.firstElementChild;for(;o;)yield o,o.nextElementSibling||await Promise.race([c((()=>!!o.nextElementSibling),e),l(i)]),o=o.nextElementSibling}async function*M(t,e,i=r,o=5e3){let n=B(`.//${t}`,e);const s=e=>B(`./following-sibling::${t}`,e);for(;n;){yield n;let t=s(n);t?n=t:(await Promise.race([c((()=>(t=s(n),t)),i),l(o)]),n=t)}}function V(t){const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}function R(t,e=0){const i=t.getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:i,behavior:"smooth"})}function F(t,e={behavior:"smooth",block:"center",inline:"center"}){t.scrollIntoView(e)}function I(t,e,i){return void 0===t.state&&(t.state={}),i&&(void 0===t.state[i]?t.state[i]=1:t.state[i]++),{state:t.state,msg:e}}},121:(t,e,i)=>{"use strict";i.r(e),i.d(e,{FacebookTimelineBehavior:()=>n});const o={feed:"//div[@role='feed']",article:".//div[@role='article']",pageletPostList:"//div[@data-pagelet='page']/div[@role='main']//div[@role='main']/div",pageletProfilePostList:"//div[@data-pagelet='page']//div[@data-pagelet='ProfileTimeline']",articleToPostList:"//div[@role='article']/../../../../div",photosOrVideos:`.//a[(contains(@href, '/photos/') or contains(@href, '/photo/?') or contains(@href, '/videos/')) and (starts-with(@href, '${window.location.origin}/') or starts-with(@href, '/'))]`,postQuery:".//a[contains(@href, '/posts/')]",extraLabel:"//*[starts-with(text(), '+')]",nextSlideQuery:"//div[@data-name='media-viewer-nav-container']/div[@data-visualcompletion][2]//div[@role='button']",nextSlide:"//div[@aria-hidden='false']//div[@role='button' and not(@aria-hidden) and @aria-label]",commentList:".//ul[(../h3) or (../h4)]",commentMoreReplies:"./div[2]/div[1]/div[2]/div[@role='button']",commentMoreComments:"./following-sibling::div/div/div[2][@role='button'][./span/span]",viewComments:".//h4/..//div[@role='button']",photoCommentList:"//ul[../h2]",firstPhotoThumbnail:"//div[@role='main']//div[3]//div[contains(@style, 'border-radius')]//div[contains(@style, 'max-width') and contains(@style, 'min-width')]//a[@role='link']",firstVideoThumbnail:"//div[@role='main']//div[contains(@style, 'z-index')]/following-sibling::div/div/div/div[last()]//a[contains(@href, '/videos/') and @aria-hidden!='true']",firstVideoSimple:"//div[@role='main']//a[contains(@href, '/videos/') and @aria-hidden!='true']",mainVideo:"//div[@data-pagelet='root']//div[@role='dialog']//div[@role='main']//video",nextVideo:"following::a[contains(@href, '/videos/') and @aria-hidden!='true']",isPhotoVideoPage:/^.*facebook\.com\/[^/]+\/(photos|videos)\/.+/,isPhotosPage:/^.*facebook\.com\/[^/]+\/photos\/?($|\?)/,isVideosPage:/^.*facebook\.com\/[^/]+\/videos\/?($|\?)/,pageLoadWaitUntil:"//div[@role='main']"};class n{extraWindow;allowNewWindow;static id="Facebook";static isMatch(){return!!(window._WB_wombat_location||window.location).href.match(/https:\/\/(www\.)?facebook\.com\/.*\/posts\//)}static init(){return{state:{}}}constructor(){this.extraWindow=null,this.allowNewWindow=!1}async*iterPostFeeds(t){const{iterChildElem:e,waitUnit:i,waitUntil:n,xpathNode:s,xpathNodes:a}=t.Lib,r=Array.from(a(o.feed));if(r&&r.length)for(const a of r)for await(const r of e(a,i,10*n))yield*this.viewPost(t,s(o.article,r));else{const a=s(o.pageletPostList)||s(o.pageletProfilePostList)||s(o.articleToPostList);if(!a)return;for await(const r of e(a,i,10*n))yield*this.viewPost(t,s(o.article,r))}this.extraWindow&&this.extraWindow.close()}async*viewPost(t,e,i=2){const{getState:n,scrollIntoView:s,sleep:a,waitUnit:r,xpathNode:l}=t.Lib;if(!e)return;const c=l(o.postQuery,e);let d=null;c&&(d=new URL(c.href,window.location.href),d.search=""),yield n(t,"Viewing post "+(d||""),"posts"),s(e),await a(2*r),l(".//video",e)&&(yield n(t,"Playing inline video","videos"),await a(2*r));let h=l(o.commentList,e);if(!h){const t=l(o.viewComments,e);t&&(t.click(),await a(2*r)),h=l(o.commentList,e)}yield*this.iterComments(t,h,i),await a(5*r)}async*viewPhotosOrVideos(t,e){const{getState:i,sleep:n,waitUnit:s,xpathNode:a,xpathNodes:r}=t.Lib,l=Array.from(r(o.photosOrVideos,e)),c=new Set;let d=0;for(const e of l){const r=new URL(e.href,window.location.href);if(-1===e.href.indexOf("?fbid")&&(r.search=""),c.has(r.href))continue;const h=e.href.indexOf("/video")>=0?"videos":"photos";++d,c.add(r.href),yield i(t,`Viewing ${h} ${r.href}`,h),e.scrollIntoView(),await n(5*s),e.click(),await n(10*s),this.allowNewWindow&&await this.openNewWindow(t,r.href),d===l.length&&(yield*this.viewExtraObjects(t,e,h,this.allowNewWindow));const u=a(o.nextSlide);u&&(u.click(),await n(2*s))}}async*viewExtraObjects(t,e,i,n){const{getState:s,sleep:a,waitUnit:r,waitUntil:l,xpathNode:c}=t.Lib,d=c(o.extraLabel,e);if(!d)return;const h=Number(d.innerText.slice(1));if(isNaN(h))return;let u;for(let e=0;e<h;e++){const e=c(o.nextSlideQuery);e&&(u=window.location.href,e.click(),await a(5*r),await l((()=>window.location.href!==u),2*r),yield s(t,`Viewing extra ${i} ${window.location.href}`),n&&await this.openNewWindow(t,window.location.href))}}async openNewWindow(t,e){this.extraWindow?this.extraWindow.location.href=e:this.extraWindow=await t.Lib.openWindow(e)}async*iterComments(t,e,i=2){const{getState:n,scrollIntoView:s,sleep:a,waitUnit:r,xpathNode:l}=t.Lib;if(!e)return void await a(5*r);let c=e.firstElementChild,d=null,h=0;for(;c&&h<i;){for(;c&&h<i;){yield n(t,"Loading comments","comments"),s(c),await a(2*r);const e=l(o.commentMoreReplies,c);e&&(e.click(),await a(5*r)),d=c,c=d.nextElementSibling,h++}if(h===i)break;const u=l(o.commentMoreComments,e);u&&(s(u),u.click(),await a(5*r),d&&(c=d.nextElementSibling,await a(5*r)))}await a(2*r)}async*iterPhotoSlideShow(t){const{getState:e,scrollIntoView:i,sleep:n,waitUnit:s,waitUntil:a,xpathNode:r}=t.Lib,l=r(o.firstPhotoThumbnail);if(!l)return;let c=window.location.href;i(l),l.click(),await n(5*s),await a((()=>window.location.href!==c),2*s);let d=null;for(;(d=r(o.nextSlideQuery))&&(c=window.location.href,await n(s),d.click(),await n(5*s),await Promise.race([a((()=>window.location.href!==c),2*s),n(3e3)]),window.location.href!==c);){yield e(t,`Viewing photo ${window.location.href}`,"photos");const i=r(o.photoCommentList);yield*this.iterComments(t,i,2),await n(5*s)}}async*iterAllVideos(t){const{getState:e,scrollIntoView:i,sleep:n,waitUnit:s,waitUntil:a,xpathNode:r,xpathNodes:l}=t.Lib,c=r("//video");c&&(i(c),await n(5*s));let d=r(o.firstVideoThumbnail)||r(o.firstVideoSimple);if(d)for(;d;){i(d);let c=window.location.href;d.click(),await a((()=>window.location.href!==c),2*s),yield e(t,"Viewing video: "+window.location.href,"videos"),await n(10*s),await Promise.race([a((()=>{for(const t of l("//video"))if(t.readyState>=3)return!0;return!1}),2*s),n(2e4)]),await n(10*s);const h=r(o.nextSlide);if(!h)break;c=window.location.href,h.click(),await a((()=>window.location.href!==c),2*s),d=r(o.nextVideo,d)}}async*run(t){const{getState:e,sleep:i,xpathNode:n}=t.Lib;if(yield e(t,"Starting..."),await i(2e3),o.isPhotosPage.exec(window.location.href))return t.state={photos:0,comments:0},void(yield*this.iterPhotoSlideShow(t));if(o.isVideosPage.exec(window.location.href))return t.state={videos:0,comments:0},void(yield*this.iterAllVideos(t));if(o.isPhotoVideoPage.exec(window.location.href)){t.state={comments:0};const e=n(o.photoCommentList);yield*this.iterComments(t,e,1e3)}else t.state={posts:0,comments:0,videos:0},yield*this.iterPostFeeds(t)}async awaitPageLoad(t){const{Lib:e,log:i}=t,{assertContentValid:n,waitUntilNode:s}=e;i("Waiting for Facebook to fully load","info"),await s(o.pageLoadWaitUntil,document,null,1e4),n((()=>!!document.querySelector("div[aria-label*='Account Controls' i]")),"not_logged_in")}}},954:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var o=i(121),n=i(741),s=i(667),a=i(739),r=i(714);const l=[n.InstagramPostsBehavior,a.TwitterTimelineBehavior,o.FacebookTimelineBehavior,s.TelegramBehavior,r.TikTokVideoBehavior,r.TikTokProfileBehavior]},741:(t,e,i)=>{"use strict";i.r(e),i.d(e,{InstagramPostsBehavior:()=>s});const o="//article[@role='presentation']//div[@role='presentation']/following-sibling::button",n={rootPath:"//main/div/div[2]/div",childMatchSelect:"string(.//a[starts-with(@href, '/')]/@href)",childMatch:"child::div[.//a[@href='$1']]",firstPostInRow:"div[1]//a",postCloseButton:"//div[last() - 2]//div[@role='button']",nextPost:"//button[.//*[local-name() = 'svg' and @aria-label='Next']]",postLoading:"//*[@aria-label='Loading...']",subpostNextOnlyChevron:o,subpostPrevNextChevron:o+"[2]",commentRoot:"//article[@role='presentation']/div[1]/div[2]//ul/div[last()]/div/div",viewReplies:"ul/li//button[span[not(count(*)) and contains(text(), '(')]]",loadMore:"//button[span[@aria-label]]",pageLoadWaitUntil:"//main"};class s{maxCommentsTime;postOnlyWindow;static id="Instagram";static isMatch(){return!!(window._WB_wombat_location||window.location).href.match(/https:\/\/(www\.)?instagram\.com\/\w[\w.-]+/)}static init(){return{state:{posts:0,slides:0,rows:0,comments:0}}}constructor(){this.maxCommentsTime=1e4,this.postOnlyWindow=null}cleanup(){this.postOnlyWindow&&(this.postOnlyWindow.close(),this.postOnlyWindow=null)}async waitForNext(t,e){return e?(await t.Lib.sleep(t.Lib.waitUnit),e.nextElementSibling?e.nextElementSibling:null):null}async*iterRow(t){const{RestoreState:e,sleep:i,waitUnit:o,xpathNode:s}=t.Lib,a=s(n.rootPath);if(!a)return;let r=a.firstElementChild;if(r)for(;r;){await i(o);const s=new e(n.childMatchSelect,r);s.matchValue&&(yield r,r=await s.restore(n.rootPath,n.childMatch)),r=await this.waitForNext(t,r)}}async*viewStandalonePost(t,e){const{getState:i,sleep:o,waitUnit:s,waitUntil:a,xpathNode:r,xpathString:l}=t.Lib,c=r(n.rootPath);if(!c?.firstElementChild)return;const d=l(n.childMatchSelect,c.firstElementChild);yield i(t,"Loading single post view for first post: "+d),window.history.replaceState({},"",d),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}));let h=null,u=null;await o(5*s),await a((()=>(h=r(n.rootPath))!==c&&h),5*s),await o(5*s),window.history.replaceState({},"",e),window.dispatchEvent(new PopStateEvent("popstate",{state:{}})),await a((()=>(u=r(n.rootPath))!==h&&u),5*s)}async*iterSubposts(t){const{getState:e,sleep:i,waitUnit:o,xpathNode:s}=t.Lib;let a=s(n.subpostNextOnlyChevron),r=1;for(;a;)a.click(),await i(5*o),yield e(t,`Loading Slide ${++r} for ${window.location.href}`,"slides"),a=s(n.subpostPrevNextChevron);await i(5*o)}async iterComments(t){const{scrollIntoView:e,sleep:i,waitUnit:o,waitUntil:s,xpathNode:a}=t.Lib,r=a(n.commentRoot);if(!r)return;let l=r.firstElementChild,c=!1;const d=t=>a(n.viewReplies,t);for(;l;){e(l),c=!0;let r=d(l);for(;r;){const e=r.textContent;r.click(),t.state.comments++,await i(2.5*o),await s((()=>e!==r.textContent),o),r=d(l)}if(l.nextElementSibling&&"LI"===l.nextElementSibling.tagName&&!l.nextElementSibling.nextElementSibling){const e=a(n.loadMore,l.nextElementSibling);e&&(e.click(),t.state.comments++,await i(5*o))}l=l.nextElementSibling,await i(2.5*o)}return c}async*iterPosts(t,e){const{getState:i,sleep:o,waitUnit:s,xpathNode:a}=t.Lib;for(;e;)for(e.click(),await o(10*s),yield i(t,"Loading Post: "+window.location.href,"posts"),await fetch(window.location.href),yield*this.iterSubposts(t),yield i(t,"Loaded Comments","comments"),await Promise.race([this.iterComments(t),o(this.maxCommentsTime)]),e=a(n.nextPost);!e&&a(n.postLoading);)await o(2.5*s);await o(5*s)}async*run(t){const{getState:e,scrollIntoView:i,sleep:o,waitUnit:s,xpathNode:a}=t.Lib;for await(const r of this.iterRow(t)){i(r),await o(2.5*s),yield e(t,"Loading Row","rows");const l=a(n.firstPostInRow,r);yield*this.iterPosts(t,l);const c=a(n.postCloseButton);c&&c.click(),await o(5*s)}}async awaitPageLoad(t){const{Lib:e,log:i}=t,{assertContentValid:o,waitUntilNode:s}=e;i("Waiting for Instagram to fully load"),await s(n.pageLoadWaitUntil,document,null,1e4),o((()=>!!document.querySelector("*[aria-label='New post']")),"not_logged_in")}}},667:(t,e,i)=>{"use strict";i.r(e),i.d(e,{TelegramBehavior:()=>a});const o="//main//section[@class='tgme_channel_history js-message_history']",n="string(./div[@data-post]/@data-post)",s="string(.//a[@class='tgme_widget_message_link_preview' and @href]/@href)";class a{static id="Telegram";static isMatch(){return!!(window._WB_wombat_location||window.location).href.match(/https:\/\/t.me\/s\/\w[\w]+/)}static init(){return{state:{messages:0}}}async waitForPrev(t,e){return e?(await t.Lib.sleep(5*t.Lib.waitUnit),e.previousElementSibling?e.previousElementSibling:null):null}async*run(t){const{getState:e,scrollIntoView:i,sleep:a,waitUnit:r,xpathNode:l,xpathString:c}=t.Lib,d=l(o);if(!d)return;let h=d.lastElementChild;for(;h;){i(h);const o=c(n,h)||"unknown",l=c(s,h);if(l?.endsWith(".jpg")||l.endsWith(".png")){yield e(t,"Loading External Image: "+l);const i=new Image;i.src=l,document.body.appendChild(i),await a(2.5*r),document.body.removeChild(i)}yield e(t,"Loading Message: "+o,"messages"),h=await this.waitForPrev(t,h)}}}},714:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BREADTH_ALL:()=>h,TikTokProfileBehavior:()=>f,TikTokSharedBehavior:()=>u,TikTokVideoBehavior:()=>w});const o="//div[contains(@class, 'CommentListContainer')]",n="div[contains(@class, 'CommentItemContainer')]",s=".//p[contains(@class, 'ReplyActionText')]",a=".//p[starts-with(@data-e2e, 'view-more') and string-length(text()) > 0]",r="//div[starts-with(@data-e2e, 'user-post-item-list')]",l="div[contains(@class, 'DivItemContainerV2')]",c="button[contains(@class, 'StyledCloseIconContainer')]",d="//*[@role='dialog']",h=Symbol("BREADTH_ALL");class u{async awaitPageLoad(t){const{assertContentValid:e,waitUntilNode:i}=t.Lib;await i(d,document,null,1e4),e((()=>!!document.querySelector("*[aria-label='Messages']")),"not_logged_in")}}class w extends u{static id="TikTokVideo";static init(){return{state:{comments:0},opts:{breadth:h}}}static isMatch(){return!!(window._WB_wombat_location||window.location).href.match(/https:\/\/(www\.)?tiktok\.com\/@.+\/video\/\d+\/?.*/)}breadthComplete({opts:{breadth:t}},e){return t!==h&&t<=e}async*crawlThread(t,e,i=null,o=0){const{waitUntilNode:n,scrollAndClick:s,getState:r}=t.Lib,l=await n(a,e,i);l&&!this.breadthComplete(t,o)&&(await s(l,500),yield r(t,"View more replies","comments"),yield*this.crawlThread(t,e,l,o+1))}async*expandThread(t,e){const{xpathNode:i,scrollAndClick:o,getState:n}=t.Lib,a=i(s,e);a&&(await o(a,500),yield n(t,"View comment","comments"),yield*this.crawlThread(t,e,null,1))}async*run(t){const{xpathNode:e,iterChildMatches:i,scrollIntoView:s,getState:a}=t.Lib,r=e(o),l=i(n,r);for await(const e of l)s(e),yield a(t,"View comment","comments"),this.breadthComplete(t,0)||(yield*this.expandThread(t,e));yield a(t,"TikTok Video Behavior Complete")}}class f extends u{static id="TikTokProfile";static isMatch(){return!!(window._WB_wombat_location||window.location).href.match(/https:\/\/(www\.)?tiktok\.com\/@[a-zA-Z0-9]+(\/?$|\/\?.*)/)}static init(){return{state:{videos:0,comments:0},opts:{breadth:h}}}async*openVideo(t,e){const{HistoryState:i,xpathNode:o,sleep:n}=t.Lib,s=o(".//a",e);if(!s)return;const a=new i((()=>s.click()));if(await n(500),a.changed){const e=new w;yield*e.run(t),await n(500),await a.goBack(c)}}async*run(t){const{xpathNode:e,iterChildMatches:i,scrollIntoView:o,getState:n,sleep:s}=t.Lib,a=e(r),c=i(l,a);for await(const e of c)o(e),yield n(t,"View video","videos"),yield*this.openVideo(t,e),await s(500);yield n(t,"TikTok Profile Behavior Complete")}}},739:(t,e,i)=>{"use strict";i.r(e),i.d(e,{TwitterTimelineBehavior:()=>p});const o="//h1[@role='heading' and @aria-level='1']/following-sibling::div[@aria-label]//div[@style]",n=".//article",s="string(.//article//a[starts-with(@href, '/') and @aria-label]/@href)",a="child::div[.//a[@href='$1']]",r=".//div[@role='button' and not(@aria-haspopup) and not(@data-testid)]",l=".//div[@role='blockquote' and @aria-haspopup='false']",c=".//a[@role='link' and starts-with(@href, '/') and contains(@href, '/photo/')]",d="//div[@aria-roledescription='carousel']/div[2]/div[1]//div[@role='button']",h="//div[@aria-roledescription='carousel']/div[2]/div[2]//div[@role='button']",u="//div[@role='presentation']/div[@role='button' and @aria-label]",w="//div[@data-testid='titleContainer']//div[@role='button']",f=".//a[@href='/settings/content_you_see']/parent::div/parent::div/parent::div//div[@role='button']",m=".//*[@role='progressbar']",g=".//div[data-testid='placementTracking']";class p{seenTweets;seenMediaTweets;static id="Twitter";static isMatch(){return!!(window._WB_wombat_location||window.location).href.match(/https:\/\/(www\.)?(x|twitter)\.com\//)}static init(){return{state:{tweets:0,images:0,videos:0},opts:{maxDepth:0}}}constructor(){this.seenTweets=new Set,this.seenMediaTweets=new Set}showingProgressBar(t,e){const{xpathNode:i}=t.Lib,o=i(m,e);return!!o&&o.clientHeight>10}async waitForNext(t,e){const{sleep:i,waitUnit:o}=t.Lib;if(!e)return null;if(await i(2*o),!e.nextElementSibling)return null;for(;this.showingProgressBar(t,e.nextElementSibling);)await i(o);return e.nextElementSibling}async expandMore(t,e){const{sleep:i,waitUnit:o,xpathNode:n}=t.Lib,s=n(r,e);if(!s)return e;const a=e.previousElementSibling;for(s.click(),await i(o);this.showingProgressBar(t,a.nextElementSibling);)await i(o);return e=a.nextElementSibling}async*infScroll(t){const{scrollIntoView:e,RestoreState:i,sleep:l,waitUnit:c,xpathNode:d}=t.Lib,h=d(o);if(!h)return;let u=h.firstElementChild;if(u)for(;u;){let h=d(n,u);if(!h&&r&&(u=await this.expandMore(t,u),h=d(n,u)),u?.innerText&&e(u),u&&h){await l(c);const t=new i(s,u);yield h,t.matchValue&&(u=await t.restore(o,a))}u=await this.waitForNext(t,u)}}async*mediaPlaying(t,e){const{getState:i,sleep:o,xpathNode:n,xpathString:a}=t.Lib,r=n("(.//video | .//audio)",e);if(!r||r.paused)return;let l,c=null;try{c=new URL(a(s,e.parentElement),window.location.origin).href}catch(t){console.warn(t)}if(r.src.startsWith("https://")&&r.src.indexOf(".mp4")>0)return void(yield i(t,`Loading video for ${c||"unknown"}`,"videos"));if(c){if(this.seenMediaTweets.has(c))return;l=`Waiting for media playback for ${c} to finish`,this.seenMediaTweets.add(c)}else l="Loading video";yield i(t,l,"videos");const d=new Promise((t=>{r.addEventListener("ended",(()=>t(null))),r.addEventListener("abort",(()=>t(null))),r.addEventListener("error",(()=>t(null))),r.addEventListener("pause",(()=>t(null)))}));await Promise.race([d,o(6e4)])}async*clickImages(t,e){const{getState:i,HistoryState:o,sleep:n,waitUnit:s,xpathNode:a}=t.Lib,r=a(c,e);if(r){const e=new o((()=>r.click()));yield i(t,"Loading Image: "+window.location.href,"images"),await n(5*s);let l=a(d),c=window.location.href;for(;l;){if(l.click(),await n(2*s),window.location.href===c){await n(5*s);break}c=window.location.href,yield i(t,"Loading Image: "+window.location.href,"images"),await n(5*s),l=a(h)}await e.goBack(u)}}async*clickTweet(t,e,i){const{getState:o,HistoryState:n,sleep:s,waitUnit:a}=t.Lib,r=new n((()=>e.click()));if(await s(a),r.changed){yield o(t,"Capturing Tweet: "+window.location.href,"tweets");i<t.opts.maxDepth&&!this.seenTweets.has(window.location.href)&&(yield*this.iterTimeline(t,i+1)),this.seenTweets.add(window.location.href),await s(2*a),await r.goBack(w),await s(a)}}async*iterTimeline(t,e=0){const{getState:i,sleep:o,waitUnit:n,xpathNode:s}=t.Lib;if(!this.seenTweets.has(window.location.href)){yield i(t,"Capturing thread: "+window.location.href,"threads");for await(const i of this.infScroll(t)){if(s(g,i))continue;await o(2.5*n);const a=s(f,i);a&&(a.click(),await o(2.5*n)),yield*this.clickImages(t,i);const r=s(l,i);r&&(yield*this.clickTweet(t,r,1e3)),yield*this.mediaPlaying(t,i),yield*this.clickTweet(t,i,e),await o(5*n)}}}async*run(t){yield*this.iterTimeline(t,0)}async awaitPageLoad(t){const{sleep:e,assertContentValid:i}=t.Lib;await e(5),i((()=>!document.documentElement.outerHTML.match(/Log In/i)),"not_logged_in")}}},171:(t,e,i)=>{"use strict";i.r(e),i.d(e,{YoutubeBehavior:()=>n});var o=i(234);class n extends o.AutoScroll{async awaitPageLoad(t){const{sleep:e,assertContentValid:i}=t.Lib;await e(10),i((()=>{const t=document.querySelector("video");return!(t&&t.paused)&&-1===document.documentElement.outerHTML.indexOf("not a bot")}),"no_video_playing")}}},75:(t,e,i)=>{var o={".":[607],"./":[607],"./autoclick":[702],"./autoclick.ts":[702],"./autofetcher":[894],"./autofetcher.ts":[894],"./autoplay":[376],"./autoplay.ts":[376],"./autoscroll":[234],"./autoscroll.ts":[234],"./index":[607],"./index.ts":[607],"./lib/behavior":[841],"./lib/behavior.ts":[841],"./lib/utils":[721],"./lib/utils.ts":[721],"./site":[954],"./site/":[954],"./site/facebook":[121],"./site/facebook.ts":[121],"./site/index":[954],"./site/index.ts":[954],"./site/instagram":[741],"./site/instagram.ts":[741],"./site/telegram":[667],"./site/telegram.ts":[667],"./site/tiktok":[714],"./site/tiktok.ts":[714],"./site/twitter":[739],"./site/twitter.ts":[739],"./site/youtube":[171,179],"./site/youtube.ts":[171,179]};function n(t){if(!i.o(o,t))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=o[t],n=e[0];return Promise.all(e.slice(1).map(i.e)).then((()=>i(n)))}n.keys=()=>Object.keys(o),n.id=75,t.exports=n}},e={};function i(o){var n=e[o];if(void 0!==n)return n.exports;var s=e[o]={exports:{}};return t[o](s,s.exports,i),s.exports}i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.e=()=>Promise.resolve(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";i(607)})()})();